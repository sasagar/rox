# =============================================================================
# Rox Environment Configuration
# =============================================================================
# Copy this file to .env and update the values as needed.
# See CLAUDE.md for detailed documentation on infrastructure options.

# =============================================================================
# Application Configuration
# =============================================================================

# Server port (default: 3000)
PORT=3000

# Environment mode: development | production
NODE_ENV=development

# Public URL of your instance (used for ActivityPub, links, etc.)
# IMPORTANT: This must match your actual public URL for federation to work
URL=http://localhost:3000

# =============================================================================
# Database Configuration
# =============================================================================

# Database type: postgres | mysql | sqlite | d1
# PostgreSQL is recommended for production VPS deployments
DB_TYPE=postgres

# Database connection string
# PostgreSQL example:
DATABASE_URL=postgresql://user:password@localhost:5432/rox

# MySQL/MariaDB example:
# DATABASE_URL=mysql://user:password@localhost:3306/rox

# SQLite example (local development):
# DATABASE_URL=sqlite://./rox.db

# Cloudflare D1 (edge deployment):
# D1_DATABASE_ID=your-d1-database-id

# -----------------------------------------------------------------------------
# Database Connection Pool Settings (PostgreSQL only)
# -----------------------------------------------------------------------------

# Maximum number of connections in the pool (default: 10)
# DB_POOL_MAX=10

# Close idle connections after this many seconds (default: 20)
# DB_IDLE_TIMEOUT=20

# Maximum connection lifetime in seconds (default: 1800 = 30 minutes)
# DB_MAX_LIFETIME=1800

# Connection timeout in seconds (default: 30)
# DB_CONNECT_TIMEOUT=30

# =============================================================================
# Storage Configuration
# =============================================================================

# Storage type: local | s3
STORAGE_TYPE=local

# -----------------------------------------------------------------------------
# Local Storage (for development or single-server deployments)
# -----------------------------------------------------------------------------

# Path for local file storage (relative to project root)
LOCAL_STORAGE_PATH=./uploads

# -----------------------------------------------------------------------------
# S3-Compatible Storage (AWS S3, Cloudflare R2, MinIO, etc.)
# -----------------------------------------------------------------------------

# S3 endpoint URL (required for S3 storage)
#
# IMPORTANT: The endpoint should NOT include the bucket name!
# The bucket name is specified separately via S3_BUCKET_NAME.
#
# Correct examples:
#   AWS S3:        https://s3.us-east-1.amazonaws.com
#   Cloudflare R2: https://{account-id}.r2.cloudflarestorage.com
#   MinIO:         http://localhost:9000
#
# Incorrect (will cause files to be uploaded to wrong paths):
#   https://{bucket-name}.{account-id}.r2.cloudflarestorage.com
#   https://rox-media.xxxxx.r2.cloudflarestorage.com
#
# S3_ENDPOINT=https://your-account.r2.cloudflarestorage.com

# S3 bucket name (specified separately from the endpoint)
# S3_BUCKET_NAME=rox-media

# S3 access credentials
# S3_ACCESS_KEY=your-access-key
# S3_SECRET_KEY=your-secret-key

# S3 region (use "auto" for R2)
# S3_REGION=auto

# Public URL for accessing stored files (CDN or direct bucket URL)
# S3_PUBLIC_URL=https://media.your-domain.com

# =============================================================================
# File Upload Configuration
# =============================================================================

# Maximum file size in bytes (default: 10MB = 10485760)
MAX_FILE_SIZE=10485760

# Maximum number of files per note (default: 4)
# MAX_FILES_PER_NOTE=4

# Allowed MIME types for uploads
# ALLOWED_MIME_TYPES=image/jpeg,image/png,image/gif,image/webp,video/mp4,video/webm

# Enable automatic WebP conversion for images (default: false)
# ENABLE_WEBP_CONVERSION=false

# =============================================================================
# Authentication & Sessions
# =============================================================================

# Session expiry in days (default: 30)
SESSION_EXPIRY_DAYS=30

# JWT secret for token signing (generate a secure random string)
# Not currently used but reserved for future JWT-based auth
# JWT_SECRET=your-secure-random-secret-here

# =============================================================================
# Registration & Moderation
# =============================================================================

# Enable new user registration (default: false)
# Set to "true" to allow public registration
ENABLE_REGISTRATION=true

# Require invitation code for registration (default: false)
# When true, users need a valid invitation code to register
# REQUIRE_INVITATION=false

# =============================================================================
# Instance Information
# =============================================================================

# Instance name (shown in NodeInfo and instance metadata)
# INSTANCE_NAME=Rox Instance

# Instance description
# INSTANCE_DESCRIPTION=A lightweight ActivityPub server

# Admin contact email (shown in NodeInfo)
# ADMIN_EMAIL=admin@example.com

# =============================================================================
# Federation & ActivityPub
# =============================================================================

# Enable federation (ActivityPub support)
# ENABLE_FEDERATION=false

# =============================================================================
# Redis / Queue Configuration
# =============================================================================

# Redis URL for caching and job queues
# Required for ActivityPub delivery queue in production
REDIS_URL=redis://localhost:6379

# Disable queue and use synchronous delivery (default: false)
# Set to "true" to disable BullMQ queue (useful when Redis/Dragonfly has issues)
# USE_QUEUE=false

# Number of retry attempts for failed ActivityPub deliveries
# DELIVERY_RETRY_ATTEMPTS=3

# Stats logging interval in milliseconds (default: 3600000 = 1 hour)
# STATS_LOG_INTERVAL_MS=3600000

# =============================================================================
# Web Push Notifications (VAPID)
# =============================================================================

# Generate VAPID keys with: bunx web-push generate-vapid-keys

# VAPID public key (share this with the frontend)
# VAPID_PUBLIC_KEY=your-vapid-public-key

# VAPID private key (keep this secret!)
# VAPID_PRIVATE_KEY=your-vapid-private-key

# Contact email for VAPID (used by push services for issue reports)
# Falls back to ADMIN_EMAIL if not set
# VAPID_CONTACT_EMAIL=mailto:admin@example.com

# =============================================================================
# Logging
# =============================================================================

# Log level: debug | info | warn | error
# Default: debug in development, info in production
# LOG_LEVEL=info

# =============================================================================
# Testing (for development only)
# =============================================================================

# Test URL for integration/e2e tests
# TEST_URL=http://localhost:3000

# Comma-separated list of test tokens for load testing
# TEST_TOKENS=token1,token2,token3
