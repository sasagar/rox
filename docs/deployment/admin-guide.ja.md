# Rox 管理者ガイド

このガイドでは、Roxインスタンス管理者向けの設定と管理タスクについて説明します。

## 目次

- [カスタム絵文字の管理](#カスタム絵文字の管理)
- [インスタンス設定](#インスタンス設定)
- [ユーザー管理](#ユーザー管理)

---

## カスタム絵文字の管理

Roxは投稿やリアクションで使用できるカスタム絵文字をサポートしています。管理者は `/admin/emojis` の管理パネルから絵文字を管理できます。

### 絵文字管理へのアクセス

1. 管理者アカウントでログイン
2. **管理** → **カスタム絵文字** に移動（または `/admin/emojis` へ直接アクセス）

### 個別の絵文字追加

1. **絵文字を追加** をクリック
2. 必須項目を入力:
   - **名前**: 小文字、数字、アンダースコアのみ（例: `happy_cat`）
   - **画像**: PNG、GIF、WebP、APNGをアップロード（最大256KB）
3. オプション項目:
   - **カテゴリ**: 絵文字のグループ分け（例: `reactions`、`animals`）
   - **エイリアス**: カンマ区切りの別名
   - **ライセンス**: ライセンス情報（例: `CC BY 4.0`）
   - **センシティブ**: NSFWコンテンツとしてマーク
4. **絵文字を追加** をクリック

### ZIPからの一括インポート

多数の絵文字を一度にインポートする場合:

1. **一括インポート** タブに移動
2. 絵文字画像を含むZIPファイルを準備
3. 詳細設定用に `meta.json` ファイルを含めることもできます
4. クリックしてアップロードするか、ZIPファイルをドラッグ＆ドロップ

#### ZIPファイルの構造

```
emojis.zip
├── meta.json (オプション)
├── happy.png
├── sad.gif
├── party.webp
└── category/
    └── subcategory_emoji.png
```

#### meta.json フォーマット

```json
[
  {
    "name": "happy",
    "file": "happy.png",
    "category": "reactions",
    "aliases": ["joy", "smile"],
    "license": "CC BY 4.0",
    "isSensitive": false
  },
  {
    "name": "party",
    "file": "party.webp",
    "category": "celebrations"
  }
]
```

**フィールド:**

| フィールド | 必須 | 説明 |
|-----------|------|------|
| `name` | はい | 絵文字名（小文字、英数字 + アンダースコア） |
| `file` | はい | ZIP内の画像ファイルパス |
| `category` | いいえ | グループ分け用カテゴリ |
| `aliases` | いいえ | 別名（配列） |
| `license` | いいえ | ライセンス情報 |
| `isSensitive` | いいえ | NSFWフラグ（デフォルト: false） |

**meta.jsonなしの場合:**

`meta.json` がない場合、絵文字名はファイル名から生成されます:
- `happy_cat.png` → `:happy_cat:`
- `Cool-Emoji.gif` → `:cool_emoji:`（正規化される）

#### インポート制限

- 最大ZIPサイズ: **50MB**
- 絵文字あたり最大ファイルサイズ: **256KB**
- 対応形式: PNG、GIF、WebP、APNG

### リモート絵文字の採用

他のActivityPubサーバーのユーザーがカスタム絵文字でリアクションすると、Roxはその絵文字を自動的に保存します。管理者はそれらをローカル絵文字として採用できます:

1. **リモート絵文字** タブに移動
2. 他サーバーから収集された絵文字を閲覧
3. ドロップダウンでサーバーごとにフィルター
4. **採用** をクリックしてローカル絵文字としてダウンロード・保存

**注意:** 採用すると画像のローカルコピーが作成されるため、リモートサーバーが利用できなくなっても絵文字は使用可能です。

### 既存の絵文字の管理

- **編集**: 絵文字にカーソルを合わせて鉛筆アイコンをクリック
- **削除**: 絵文字にカーソルを合わせてゴミ箱アイコンをクリック
- **検索**: 検索ボックスで名前やエイリアスで絵文字を検索
- **フィルター**: カテゴリドロップダウンでカテゴリ別にフィルター

---

## インスタンス設定

### 基本設定

`/admin/settings` でインスタンス設定にアクセス:

- **インスタンス名**: Roxインスタンスの表示名
- **インスタンス説明**: ランディングページに表示される短い説明
- **管理者連絡先**: 管理者のメールアドレス
- **登録**: 新規ユーザー登録の有効/無効

### インスタンスアイコン

Roxはライトテーマとダークテーマで別々のアイコンをサポートしています:

- **ライトモードアイコン**: ユーザーがライトテーマを有効にしている場合に表示
- **ダークモードアイコン**: ユーザーがダークテーマを有効にしている場合に表示
- ライトモードアイコンのみ設定されている場合、両方のテーマで使用されます

推奨仕様:
- 形式: PNG または SVG
- サイズ: 512x512ピクセル（または正方形のアスペクト比）
- 透明背景推奨

---

## ユーザー管理

### ロールと権限

Roxはロールベースの権限システムを使用しています。管理者は:

1. 特定の権限を持つカスタムロールを作成
2. ユーザーにロールを割り当て
3. 新規ユーザーのデフォルトロールを設定

### 利用可能な権限

| 権限 | 説明 |
|------|------|
| `canManageCustomEmojis` | カスタム絵文字の追加・編集・削除 |
| `canManageUsers` | ユーザーアカウントの管理 |
| `canManageRoles` | ロールの作成と変更 |
| `canViewAdminDashboard` | 管理ダッシュボードへのアクセス |
| `canManageInstance` | インスタンス設定の変更 |

### ユーザーのモデレーション

管理パネルから、管理者は以下の操作が可能:

- **サスペンド**: ユーザーアカウントを一時的に無効化
- **サイレンス**: ユーザーの投稿の表示を制限
- **削除**: ユーザーアカウントを永久に削除

---

## トラブルシューティング

### 絵文字インポートの問題

**「ファイルが大きすぎます」エラー:**
- 各絵文字画像が256KB以下であることを確認
- インポート前に画像を圧縮することを検討

**「無効な絵文字名」エラー:**
- 名前には小文字、数字、アンダースコアのみ使用可能
- スペース、ハイフン、特殊文字は避ける

**「既に存在します」警告:**
- 同じ名前の絵文字が既に存在
- 新しい絵文字の名前を変更するか、既存のものを削除

### リモート絵文字の問題

**他サーバーからの絵文字が表示されない:**
- インスタンスがリモートサーバーに到達できることを確認
- リモート絵文字のURLがアクセス可能か確認
- リモートユーザーがリアクションした時に絵文字が収集されます

---

## APIリファレンス

プログラムによる絵文字管理については、[APIドキュメント](/docs/api/)を参照してください。

### 絵文字エンドポイント

- `GET /api/emojis` - すべてのローカル絵文字を一覧
- `POST /api/emojis/create` - 新規絵文字を作成
- `PATCH /api/emojis/:id` - 絵文字を更新
- `DELETE /api/emojis/:id` - 絵文字を削除
- `GET /api/emojis/remote` - リモート絵文字を一覧（管理者）
- `POST /api/emojis/adopt` - リモート絵文字を採用（管理者）
- `POST /api/emojis/import` - ZIPから一括インポート（管理者）
