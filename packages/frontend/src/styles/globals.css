@import "tailwindcss";
@import "./mfm.css";
@import "katex/dist/katex.min.css";

@theme {
  /* Primary color palette - dynamically set by ThemeProvider */
  /* Default: Blue (#3b82f6) in OKLCH color space (hue ~264Â°) */
  --color-primary-50: oklch(98% 0.01 264);
  --color-primary-100: oklch(95% 0.04 264);
  --color-primary-200: oklch(90% 0.08 264);
  --color-primary-300: oklch(83% 0.12 264);
  --color-primary-400: oklch(75% 0.16 264);
  --color-primary-500: oklch(62% 0.18 264);
  --color-primary-600: oklch(58% 0.17 264);
  --color-primary-700: oklch(48% 0.14 264);
  --color-primary-800: oklch(38% 0.10 264);
  --color-primary-900: oklch(30% 0.07 264);
  --color-primary-950: oklch(20% 0.04 264);

  /* Animations */
  --animate-slide-in: slide-in 0.3s ease-out;
  --animate-slide-in-down: slide-in-down 0.3s ease-out;
  --animate-fade-in: fade-in 0.2s ease-out;
  --animate-scale-in: scale-in 0.2s ease-out;
  --animate-spin: spin 1s linear infinite;
  --animate-pulse-subtle: pulse-subtle 2s ease-in-out infinite;
  --animate-indeterminate: indeterminate 1.5s ease-in-out infinite;
}

/* Light mode (default) */
:root {
  --bg-primary: #ffffff;
  --bg-secondary: #f9fafb;
  --bg-tertiary: #f3f4f6;
  --text-primary: #111827;
  --text-secondary: #4b5563;
  --text-muted: #9ca3af;
  --border-color: #e5e7eb;
  --card-bg: #ffffff;
  --card-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);

  /* UI Settings - Default values (medium) */
  --rox-font-size: 14px;
  --rox-line-height: 1.6;
  --rox-content-width: 800px;

  /* Base font size for scaling (percentage of --rox-font-size relative to 14px) */
  --rox-font-scale: 1;
}

/* Dark mode */
.dark {
  --bg-primary: #111827;
  --bg-secondary: #1f2937;
  --bg-tertiary: #374151;
  --text-primary: #f9fafb;
  --text-secondary: #d1d5db;
  --text-muted: #9ca3af;
  --border-color: #374151;
  --card-bg: #1f2937;
  --card-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.3), 0 1px 2px -1px rgb(0 0 0 / 0.3);
}

/* Apply theme colors and UI settings to root elements */
html {
  /* Apply font size to root for global scaling */
  font-size: var(--rox-font-size);
}

body {
  font-family: "M PLUS Rounded 1c", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  background-color: var(--bg-secondary);
  color: var(--text-primary);
  line-height: var(--rox-line-height);
  transition: background-color 0.2s ease, color 0.2s ease;
}

/* Toast notification animations */
@keyframes slide-in {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

/* Spinner animation */
@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

/* Indeterminate progress bar animation */
@keyframes indeterminate {
  0% {
    transform: translateX(-100%);
  }
  50% {
    transform: translateX(0);
  }
  100% {
    transform: translateX(100%);
  }
}

/* Slide in from top animation (for new timeline items) */
@keyframes slide-in-down {
  from {
    transform: translateY(-20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* Fade in animation */
@keyframes fade-in {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Scale in animation (for buttons, reactions) */
@keyframes scale-in {
  from {
    transform: scale(0.9);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

/* Subtle pulse animation (for status indicators) */
@keyframes pulse-subtle {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.6;
  }
}

/* UI Settings - Applied to main content areas */
.rox-content {
  font-size: var(--rox-font-size);
  line-height: var(--rox-line-height);
}

.rox-content-container {
  max-width: var(--rox-content-width);
}

/* Note content styling with UI settings */
.note-content {
  font-size: var(--rox-font-size);
  line-height: var(--rox-line-height);
}

/* User profile content */
.profile-bio {
  font-size: var(--rox-font-size);
  line-height: var(--rox-line-height);
}

/* Mobile input zoom prevention
 * iOS Safari zooms on input focus when font-size < 16px.
 * Apply minimum 16px on mobile touch devices to prevent unwanted zoom.
 */
@media (hover: none) and (pointer: coarse) {
  input,
  textarea,
  select {
    font-size: max(16px, 1rem) !important;
  }
}

/* PWA Safe Area Support
 * Handles notched devices (iPhone X+, Dynamic Island) and standalone PWA mode.
 * Uses env() for safe-area-inset values with fallbacks.
 * Reference: https://webkit.org/blog/7929/designing-websites-for-iphone-x/
 */
.safe-area-inset-bottom {
  padding-bottom: env(safe-area-inset-bottom, 0px);
}

.safe-area-inset-top {
  padding-top: env(safe-area-inset-top, 0px);
}

/* Fixed/sticky header support for notched devices (Dynamic Island, notch, status bar)
 * For elements positioned with `fixed top-0` or `sticky top-0`, use these classes
 * to position content below the safe area.
 */
.fixed-top-safe {
  top: env(safe-area-inset-top, 0px);
}

.sticky-top-safe {
  top: env(safe-area-inset-top, 0px);
}

/* PWA standalone mode specific adjustments */
@media all and (display-mode: standalone) {
  /* Ensure proper spacing for notched devices */
  .safe-area-inset-bottom {
    padding-bottom: max(env(safe-area-inset-bottom, 0px), 8px);
  }

  .safe-area-inset-top {
    padding-top: max(env(safe-area-inset-top, 0px), 8px);
  }

  /* Fixed/sticky headers in PWA mode need top offset for notch/Dynamic Island */
  .fixed-top-safe {
    top: env(safe-area-inset-top, 0px);
  }

  .sticky-top-safe {
    top: env(safe-area-inset-top, 0px);
  }
}

/* iOS 26+ PWA Compatibility
 * iOS 26 has issues with fixed/sticky elements and viewport calculations.
 * Using dvh (dynamic viewport height) and overscroll-behavior helps.
 * Reference: https://stackoverflow.com/questions/79753701/
 */
@supports (height: 100dvh) {
  @media all and (display-mode: standalone) {
    html {
      height: 100dvh;
    }

    body {
      min-height: 100dvh;
      overscroll-behavior: contain;
    }
  }
}

/* Mobile sticky header below fixed header (for PageHeader in Layout)
 * Accounts for fixed header height (64px/4rem). Safe area is handled by the header itself.
 * Only applied on mobile (< lg breakpoint)
 */
.sticky-below-mobile-header {
  top: 4rem;
}

@media (min-width: 1024px) {
  .sticky-below-mobile-header {
    top: 0;
  }
}

/* Mobile content padding below fixed header
 * Accounts for fixed header height (64px/4rem). Safe area is handled by the header itself.
 */
.pt-mobile-header {
  padding-top: 4rem;
}

@media (min-width: 1024px) {
  .pt-mobile-header {
    padding-top: 0;
  }
}

/* Fixed header with safe area padding (covers entire top area including notch/Dynamic Island)
 * Use this for headers that should have their background extend into the safe area.
 * Unlike fixed-top-safe which positions below the safe area, this class positions
 * at top: 0 and adds padding to push content below the safe area while the
 * background color fills the entire area.
 */
.fixed-top-with-safe-area-bg {
  top: 0;
  padding-top: env(safe-area-inset-top, 0px);
}

/* Scroll to top button positioning for PWA
 * Accounts for bottom navigation bar (5rem/80px) plus safe area inset for home indicator
 */
.scroll-to-top-safe {
  bottom: calc(5rem + env(safe-area-inset-bottom, 0px));
}

@media (min-width: 1024px) {
  .scroll-to-top-safe {
    bottom: 1.5rem;
  }
}
